<div id="popUp" title="Crear forma">
  <div class="container">
    <div id="centralTool">
      <div class="row">
        <div id="designs" class="col-md-3">
          <h4>Formas</h4>
          <div id="imagenesFormas">
            <div id="base1" class="col-md-5" onClick="displayParticiones(this)">
              <img src="./img/bases/Base 1.png"  class="design">
            </div>
            <div id="base2" class="col-md-5" onClick="displayParticiones(this)">
              <img src="./img/bases/Base 2.png" class="design">
            </div>
            <div id="base3" class="col-md-5" onClick="displayParticiones(this)">
              <img src="./img/bases/Base 3.png" class="design">
            </div>
            <div id="base4" class="col-md-5" onClick="displayParticiones(this)">
              <img src="./img/bases/Base 4.png" class="design">
            </div>
            <div id="base5" class="col-md-5" onClick="displayParticiones(this)">
              <img src="./img/bases/Base 5.png" class="design">
            </div>
            <div id="base6" class="col-md-5" onClick="displayParticiones(this)">
              <img src="./img/bases/Base 6.png" class="design">
            </div>
          </div>
          <div id ="particiones1" class="particiones">
            <h4>Particiones</h4>
            <div id="imagenesParticiones">
              <div id="particion11" class="col-md-5" onClick="displayColores(this)">
                <img src="./img/particiones/base 1/Particion 1.jpg" onClick="displayColores(this)"  class="design">
              </div>
              <div id="particion12" class="col-md-5" onClick="displayColores(this)">
                <img src="./img/particiones/base 1/Particion 2.jpg" onClick="displayColores()" class="design">
              </div>
              <div id="particion13" class="col-md-5" onClick="displayColores(this)">
                <img src="./img/particiones/base 1/Particion 3.jpg" onClick="displayColores()" class="design">
              </div>
            </div>
          </div>
          <div id ="particiones2" class="particiones">
            <h4>Particiones</h4>
            <div id="imagenesParticiones">
              <div id="particion11" class="col-md-5" onClick="displayColores(this)">
                <img src="./img/particiones/base 2/Particion 1.jpg" onClick="displayColores()" class="design">
              </div>
              <div id="particion12" class="col-md-5" onClick="displayColores(this)">
                <img src="./img/particiones/base 2/Particion 2.jpg" onClick="displayColores()" class="design">
              </div>
              <div id="particion13" class="col-md-5" onClick="displayColores(this)">
                <img src="./img/particiones/base 2/Particion 3.jpg" onClick="displayColores()" class="design">
              </div>
            </div>
          </div>

          <div id="colorParticion1">
            Partición 1:
            <select id="particion1" name="colorpicker-picker-shortlist" onchange="if (this.selectedIndex) displayDesign(this);">
              <option value="#808080">Sin Color</option>
              <option value="#FCDD09">Oro(Amarillo)</option>
              <option value="#BFAF3F">Oro</option>
              <option value="#F5F5F5">Plata(Blanco)</option>
              <option value="#C2C1BD">Plata</option>
              <option value="#008AF0">Azur</option>
              <option value="#FF2611">Gules</option>
              <option value="#07C143">Sinople</option>
              <option value="#000000">Sable</option>
              <option value="#EF61C6">Púrpura</option>
            </select>
          </div>
          <div id="colorParticion2">
            Partición 2:
            <select id="particion2" name="colorpicker-picker-shortlist" onchange="if (this.selectedIndex) displayDesign(this);">
              <option value="#808080">Sin Color</option>
              <option value="#FCDD09">Oro(Amarillo)</option>
              <option value="#BFAF3F">Oro</option>
              <option value="#F5F5F5">Plata(Blanco)</option>
              <option value="#C2C1BD">Plata</option>
              <option value="#008AF0">Azur</option>
              <option value="#FF2611">Gules</option>
              <option value="#07C143">Sinople</option>
              <option value="#000000">Sable</option>
              <option value="#EF61C6">Púrpura</option>
            </select>
          </div>
          <div id="colorParticion3">
            Partición 3:
            <select id="particion3" name="colorpicker-picker-shortlist" onchange="if (this.selectedIndex) displayDesign(this);">
              <option value="#808080">Sin Color</option>
              <option value="#FCDD09">Oro(Amarillo)</option>
              <option value="#BFAF3F">Oro</option>
              <option value="#F5F5F5">Plata(Blanco)</option>
              <option value="#C2C1BD">Plata</option>
              <option value="#008AF0">Azur</option>
              <option value="#FF2611">Gules</option>
              <option value="#07C143">Sinople</option>
              <option value="#000000">Sable</option>
              <option value="#EF61C6">Púrpura</option>
            </select>
          </div>
          <div id="colorParticion4">
            Partición 4:
            <select id="particion4" name="colorpicker-picker-shortlist" onchange="if (this.selectedIndex) displayDesign(this);">
              <option value="#808080">Sin Color</option>
              <option value="#FCDD09">Oro(Amarillo)</option>
              <option value="#BFAF3F">Oro</option>
              <option value="#F5F5F5">Plata(Blanco)</option>
              <option value="#C2C1BD">Plata</option>
              <option value="#008AF0">Azur</option>
              <option value="#FF2611">Gules</option>
              <option value="#07C143">Sinople</option>
              <option value="#000000">Sable</option>
              <option value="#EF61C6">Púrpura</option>
            </select>
          </div>
          <!--<div id="colores11" class="colores">
            <h4>Colores</h4>
            <div id="imagenesColores">
              <div id="color1" class="col-md-5">
                <img src="./img/colores/base 1/particion 1/Color 1.jpg" class="design" onClick="displayDesign(this)">
              </div>
              <div id="color2" class="col-md-5">
                <img src="./img/colores/base 1/particion 1/Color 2.jpg" class="design" onClick="displayDesign(this)">
              </div>
            </div>
          </div>
          <div id="colores12" class="colores">
            <h4>Colores</h4>
            <div id="imagenesColores">
              <div id="color1" class="col-md-5"
                <img src="./img/colores/base 1/particion 2/Color 1.jpg" class="design" onClick="displayDesign(this)">
              </div>
              <div id="color2" class="col-md-5">
                <img src="./img/colores/base 1/particion 2/Color 2.jpg"class="design" onClick="displayDesign(this)">
              </div>
            </div>
          </div>
          <div id="colores21" class="colores">
              <h4>Colores</h4>
              <div id="imagenesColores">
                <div id="color1" class="col-md-5">
                  <img src="./img/colores/base 2/particion 1/Color 1.jpg" class="design" onClick="displayDesign(this)">
                </div>
              </div>
          </div>
          <div id="colores22" class="colores">
              <h4>Colores</h4>
              <div id="imagenesColores">
                <div id="color2" class="col-md-5">
                  <img src="./img/colores/base 2/particion 2/Color 2.jpg" class="design" onClick="displayDesign(this)">
                </div>
              </div>
          </div>-->
        </div>
        <div id="previsualization" class="col-md-8">
          <!--img id="back" src="./img/bases/Base 1.png" >
          <img id="blank" src="./img/particiones/base 1/Particion 1.png" onload="getPixels(this)" onClick="changeColor(0)"-->
          <!--img id="particion2" src="./img/particiones/base 1/Particion 1.png" onload="getPixels(this)" onClick="changeColor(0)">
          <img id="particion3" src="./img/particiones/base 1/Particion 1.png" onload="getPixels(this)" onClick="changeColor(0)"-->
          <img id="back">
          <img id="part1">
          <img id="part2">
          <img id="part3">
        </div>
      </div>
    </div> 
  </div>
</div>

<script>
  var base = -1;
  var particion = -1;
  var color1Activado, color2Activado, color3Activado, color4Activado = false;
  var color1Valor, color2Valor, color3Valor, color4Valor = "none";

  var blank = document.getElementById("blank");
  var back = document.getElementById("back");
  var canvas = document.createElement("canvas");
  var ctx = canvas.getContext("2d");
  var originalPixels = null;
  var currentPixels = null;

  function getPixels(img)  {
      canvas.width = img.width;
      canvas.height = img.height;

      ctx.drawImage(img, 0, 0, img.naturalWidth, img.naturalHeight, 0, 0, img.width, img.height);
      originalPixels = ctx.getImageData(0, 0, img.width, img.height);
      currentPixels = ctx.getImageData(0, 0, img.width, img.height);

      img.onload = null;
  }

  function changeColor(r)  {
      if(!originalPixels) return; // Check if image has loaded
      var newColor = {
        R: r,
        G: 0,
        B: 256,
      };

      for(var I = 0, L = originalPixels.data.length; I < L; I += 4)
      {
          if(currentPixels.data[I + 3] > 0) // If it's not a transparent pixel
          {
              currentPixels.data[I] = originalPixels.data[I] / 255 * newColor.R;
              currentPixels.data[I + 1] = originalPixels.data[I + 1] / 255 * newColor.G;
              currentPixels.data[I + 2] = originalPixels.data[I + 2] / 255 * newColor.B;
          }
      }

      ctx.putImageData(currentPixels, 0, 0);
      blank.src = canvas.toDataURL("image/png");
  }

  $('select[name="colorpicker-picker-shortlist"]').simplecolorpicker({picker: true, theme: 'glyphicons'});


  function displayParticiones(item) {
    var id = item.id;
    var src = item.children[0].src;
    $("#back").attr("src", src);
    if(particion != -1) {
      var colores = "#colores" + base + particion;
      $(colores).css("display", "none");
      particion = -1;
    }
    if(base != -1) {
      var particiones = "#particiones" + base;
      $(particiones).css("display", "none");
      base = -1;
    } 
    base = item.id.substr(id.length - 1);
    var particiones = "#particiones" + base;
    $(particiones).css("display", "block");
  }

  function oldDisplayColores(item) {
    console.log(item.children[0].src);
    var id = item.id;
    var src = item.children[0].src;
    //$("#blank").attr("src", src);
    $("#part1").attr("src", src);
    if(particion != -1) {
      var colores = "#colores" + base + particion;
      $(colores).css("display", "none");
      particion = -1;
    }
    particion = item.id.substr(id.length - 2);
    //var colores = "#colores" + base + particion;
    if(particion >= 10 && particion < 20) {
      $("#colorParticion1").css("display", "block");
      $("#colorParticion2").css("display", "block");
      color1Activado = true;
      color2Activado = true;
    } 
    else if(particion >= 20 && particion < 30) {
      $("#colorParticion1").css("display", "block");
      $("#colorParticion2").css("display", "block");
      $("#colorParticion3").css("display", "block");
      color1Activado = true;
      color2Activado = true;
      color3Activado = true;
    }
    else if(particion >= 30 && particion < 40) {
      $("#colorParticion1").css("display", "block");
      $("#colorParticion2").css("display", "block");
      $("#colorParticion3").css("display", "block");
      $("#colorParticion4").css("display", "block");
      color1Activado = true;
      color2Activado = true;
      color3Activado = true;
      color4Activado = true;
    }
    
  }

  function displayColores(item) {
    console.log(item.children[0].src);
    var id = item.id;
    var src = item.children[0].src;
    //$("#blank").attr("src", src);
    $("#part1").attr("src", src);
    if(particion != -1) {
      var colores = "#colores" + base + particion;
      $(colores).css("display", "none");
      particion = -1;
    }
    particion = item.id.substr(id.length - 2);
    //var colores = "#colores" + base + particion;
    if(particion >= 10 && particion < 20) {
      $("#colorParticion1").css("display", "block");
      $("#colorParticion2").css("display", "block");
      color1Activado = true;
      color2Activado = true;
    } 
    else if(particion >= 20 && particion < 30) {
      $("#colorParticion1").css("display", "block");
      $("#colorParticion2").css("display", "block");
      $("#colorParticion3").css("display", "block");
      color1Activado = true;
      color2Activado = true;
      color3Activado = true;
    }
    else if(particion >= 30 && particion < 40) {
      $("#colorParticion1").css("display", "block");
      $("#colorParticion2").css("display", "block");
      $("#colorParticion3").css("display", "block");
      $("#colorParticion4").css("display", "block");
      color1Activado = true;
      color2Activado = true;
      color3Activado = true;
      color4Activado = true;
    }
    
  }

  function displayDesign(item) {
    var id = item.id;
    if(id == "particion1") {
      color1Valor = item.value;
      if(color2Activado) {
        if(color2Valor != "none") {
          if(color3Activado) {
            if(color3Valor != "none") {
              if(color4Activado) {
                if(color4Valor != "none") $("#blank").attr("src", src);
              }
              else $("#blank").attr("src", src);
            }
          }
          else $("#blank").attr("src", src);
        }
      }
      else $("#blank").attr("src", src);
    }
    else if(id == "particion2") {
      color2Valor = item.value;
    }
    else if(id == "particion3") {
      color3Valor = item.value;
    }
    else if(id == "particion4") {
      color4Valor = item.value;
    }
  }
</script>